name: codex
run-name: "codex PR #${{ github.event.issue.number || 'manual' }}: ${{ github.event.comment.body || inputs.task }}"

on:
  issue_comment:
    types: [created]
  workflow_dispatch:
    inputs:
      task:   { description: "Task", required: true, type: string }
      resume: { description: "none|chat|full", required: false, default: none }

permissions:
  contents: write
  pull-requests: write

jobs:
  codex:
    if: >
      github.event_name == 'workflow_dispatch' ||
      (github.event_name == 'issue_comment' &&
       contains(github.event.comment.body, '@codex'))
    uses: JoernStoehler/codex-github-app/.github/workflows/codex.yml@v1
    secrets: inherit
    with:
      container_image: mcr.microsoft.com/devcontainers/universal:2-linux
      lifecycle_scripts: |
        .devcontainer/post-create.sh
        .devcontainer/post-start.sh
      resume: ${{ inputs.resume || 'none' }}
      model: gpt5-codex-medium
      thinking_budget: medium
      artifact_retention_days: 90
      danger_mode: true
      ready_on_success: false
